<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ATGSD SEA PAY PROCESSOR</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: #dcdcdc;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #007acc;
            padding: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
        }
        .container {
            padding: 20px;
        }
        .box {
            background-color: #252526;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #3c3c3c;
        }
        h2 {
            color: #9cdcfe;
            margin-top: 0;
        }
        input, select, button {
            margin: 5px 0;
            padding: 8px;
            font-size: 1em;
        }
        button {
            cursor: pointer;
            background-color: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #1177bb;
        }
        #logBox {
            background-color: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            height: 280px;
            overflow-y: auto;
            white-space: pre-line;
            font-size: 0.9em;
        }
        .download-buttons button {
            width: 100%;
            margin-top: 5px;
        }
        .status {
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 10px;
            color: #4ec9b0;
        }
    </style>
</head>

<body>
<header>ATGSD SEA PAY PROCESSOR</header>

<div class="container">

    <!-- Upload Section -->
    <div class="box">
        <h2>1. Upload TORIS Sheets</h2>

        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" name="files" id="files" multiple accept="application/pdf" /><br>

            <label for="strikeColor">Strikeout Color:</label>
            <select name="strikeColor" id="strikeColor">
                <option value="black">Black</option>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
            </select><br><br>

            <button id="submitBtn" type="submit">RUN PROCESSOR</button>
        </form>

        <div id="statusText" class="status">STATUS: READY</div>
    </div>

    <!-- Log Viewer -->
    <div class="box">
        <h2>System Logs</h2>
        <div id="logBox"></div>
    </div>

    <!-- Download Buttons -->
    <div class="box download-buttons">
        <h2>2. Download Outputs</h2>
        <button onclick="window.location.href='/download_merged'">MERGED SEA PAY PG13</button>
        <button onclick="window.location.href='/download_summary'">MERGED SUMMARY</button>
        <button onclick="window.location.href='/download_marked_sheets'">TORIS Sea Pay Cert Sheets</button>
        <button onclick="window.location.href='/download_tracking'">TRACKER FILE</button>
        <button onclick="window.location.href='/download_all'">EXPORT ZIP</button>
    </div>

    <!-- Reset Button -->
    <div class="box">
        <button style="background-color:#b30000;" onclick="resetAll()">RESET SYSTEM</button>
    </div>

</div>

<script>
//
// FIXED PROCESSOR POST
// ---------------------
// Your old JS posted to "/" which NEVER triggered backend processing.
// Now it posts to "/process" which calls process_all() correctly.
//

document.getElementById("uploadForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const btn = document.getElementById("submitBtn");

    btn.disabled = true;
    btn.innerText = "PROCESSING...";
    statusText.innerText = "STATUS: PROCESSING...";

    fetch("/process", { method: "POST", body: formData })
        .then(() => {
            btn.disabled = false;
            btn.innerText = "RUN PROCESSOR";
            statusText.innerText = "STATUS: COMPLETE";
        })
        .catch(() => {
            btn.disabled = false;
            btn.innerText = "RUN PROCESSOR";
            statusText.innerText = "STATUS: ERROR";
        });
});


//
// FIXED RESET BUTTON
// ---------------------
// The old JS tried to send a POST to /reset, but routes.py only had GET.
// Now it uses GET correctly.
//

function resetAll() {
    if (!confirm("Delete ALL input/output files and logs?")) return;

    fetch("/reset")
        .then(() => {
            alert("System reset complete.");
            statusText.innerText = "STATUS: READY";
        });
}

//
// Live log updater (unchanged)
//
function updateLogs() {
    fetch("/logs")
        .then(r => r.text())
        .then(text => {
            document.getElementById("logBox").innerText = text;
        });
}

setInterval(updateLogs, 1000);
</script>

</body>
</html>
